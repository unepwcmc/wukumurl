<% title "Shared documents by WCMC" %>

<div class="left">
  <%= render partial: "headline_number", locals: {
    title: "Total number of visits",
    value: @total_visits
  } %>

  <%= render partial: "headline_number", locals: {
    title: "Number of links shared",
    value: @total_urls
  } %>

  <section>
    <header>
      <h4>Top links by number of visits</h4>
    </header>

    <%= render partial: "short_urls_table", locals: {
      data: @short_urls
    } %>
  </section>
</div>

<div class="right">
  <%= render partial: "chart_block" %>
  <%= render partial: "organizations_table", locals: {
    title: "Top organizations by number of visits"
  } %>
</div>

<script>
  $(document).ready(function() {
    cartodb.createLayer(map, "http://carbon-tool.cartodb.com/api/v2/viz/34dd3c30-9ed0-11e3-808f-0ed66c7bc7f3/viz.json")
      .addTo(map)
      .on('done', function(layer) {
        layer.setInteraction(true);
        layer.on('featureOver', function(e, pos, latlng, data) {
          cartodb.log.log(e, pos, latlng, data);
        });
        layer.on('error', function(err) {
          cartodb.log.log('error: ' + err);
        });
    }).on('error', function() {
      cartodb.log.log("some error occurred");
    });
  });
</script>
