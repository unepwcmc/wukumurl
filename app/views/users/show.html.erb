<% title "Your shared links" %>

<div class="left">
  <%= render partial: "short_urls/headline_number", locals: {
    title: "Total number of visits",
    value: @total_visits
  } %>

  <section>
    <header>
      <h4>Your links</h4>
    </header>

    <div id="short_urls_table" class="expandable-table">
      <%= render partial: "short_urls/short_urls_table" %>
    </div>
  </section>
</div>

<div class="right">
  <%= render partial: "short_urls/chart_block" %>
  <%= render partial: "short_urls/organizations_table", locals: {
    title: "Top organizations by number of visits"
  } %>
</div>

<script>
  $(document).ready(function() {
    var carto_table = "<%= CARTODB_LAYERS_CONFIG['tables'][Rails.env]['organizations_by_user'] %>";
    cartodb.createLayer(map, {
      user_name: '<%= CARTODB_CONFIG['username'] %>',
      type: 'cartodb',
      sublayers: [{
        sql: "SELECT * FROM " + carto_table + " WHERE user_id=<%= current_user.id %>;",
        cartocss: "#" + carto_table + "<%= raw CARTODB_LAYERS_CONFIG['css'] %>"
      }]
    })
    .addTo(map)
    .on('done', function(layer) {
      layer.setInteraction(true);
      cdb.vis.Vis.addInfowindow(map, layer.getSubLayer(0), ['org_name', 'visits']);
    }).on('error', function() {
      cartodb.log.log("some error occurred");
    });
  });
</script>
